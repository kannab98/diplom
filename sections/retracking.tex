%!TEX root = ../diplom.tex
\section{Алгоритм ретрекинга}
\begin{figure}[h]
    \centering
    %\includegraphics[width=0.6\linewidth]{fig/geometry}
    \caption{Геометрия отклика от плоской поверхности.}
    \label{fig:geometry}
\end{figure}
Посчитаем теоретически отклик плоской морской поверхности $P_{FS}$ на сигнал с
радиолокатора с известной диаграммой направленности $G(\theta,hueta)$.


Форма функции $P_{FS}$ ... 

Из работы \cite{moore-and-williams} 

\begin{equation}
    P_{FS}(t) = \frac{\lambda^2}{(4 \pi)^3 L_p} \int\limits_{(A)} 
    \frac
        {\delta\qty(t - \frac{2r}{c}) G^2(\theta,\omega) \sigma^o(\psi,\phi)}
        {r^4} 
    \dd A
\end{equation}

где
$\lambda$ -- длина волны радиолокатора
$L_p$ -- \sout{набег в две стороны} 
$\delta(t - \frac{2r}{c})$ -- дельта функция
$G(\theta, \omega)$ -- диаграмма направленности
 $r$ -- расстояние от спутника и элементарной рассеивающей поверхностью

 Элемент поверхности можно записать как $\dd A = \rho \dd \rho \dd \psi$,
 однако нам нужна  только $\theta$ как функция $\rho$ и $\phi$ для
 интегрирования по углу. Используя тригонометрию, получим
 \begin{equation}
     \label{eq:}
     \cos \theta = 
     \frac{\cos \xi + \frac{\rho}{h} \sin \xi \cos(\tilde \phi - \phi)}{\sqrt{q
     + (\frac{\rho}{h})^2}}
 \end{equation}


 Диаграмму направленности аппроксимируем следующей функцией
 \begin{equation}
     \label{eq:}
     G(\theta) \approx G_0 e^{-\frac{2}{\gamma} \sin^2 \theta}
 \end{equation}

 с учетом $r = \sqrt{h^{2} + \rho^{2}}$ 
 \begin{multline}
     P_{FS}(t) = \frac{G_0^2\lambda^2}{G_0^2 \lambda^2 (4 \pi)^3 L_p h^4}
     \int\limits_{0}^{\infty} \int\limits_{0}^{2 \pi}   
     \frac{\delta\qty(t - \frac{2h}{c}\sqrt{1+ \epsilon^2})}{(1+\epsilon^2)^2} \sigma^o(\psi)
     \\
     \cdot \exp{-\frac{4}{\gamma} \qty[1 - \frac{\cos^2 \xi}{1+ \epsilon^2}] + b
     + a\cos(\tilde \phi - \phi) - b \sin^2(\tilde \phi - \phi)} \dd \phi \rho
     \dd \rho,
 \end{multline}
 где 
 $\epsilon = \frac{\rho}{h}$,
 $a = \frac{4\epsilon}{\gamma} \frac{\sin 2 \xi}{(1+ \epsilon^2)}$,
 $b= \frac{4\epsilon^2}{\gamma} \frac{\sin^2 \xi}{(1+\epsilon^2)}$,

 поскольку интегрирование идет по полному периоду косинуса и синуса, то мы
 можем игнорировать $\tilde \phi$. 
 Разложим в ряд экспоненту, пользуясь малостью $b$
  \begin{equation}
     \label{eq:}
     e^{- b \sin^2 \phi} = \sum\limits_{n=0}^{\infty} 
     \frac{(-1)^2 b^n \sin^{2n}\phi}{n!}
 \end{equation}
 Браун в своей работе \cite{brown} вычислил этот интеграл и показал, что он
 равен
 \begin{multline}
     \label{eq:}
     P_{FS} = \frac{G_0^2 \lambda^2 c}{4(4 \pi)^2 L_p h^3} \cdot
     \frac{\sigma^o(\psi)}{(\frac{ct}{2h})^3} 
     \cdot \exp{
         -\frac{4}{\gamma} 
         \qty[
         \cos^2 \xi - \frac{\cos 2\xi}{(\frac{ct}{2h})^2}
     ]}
     \\
     \cdot (1+\epsilon^2)^2\sum\limits_{n=0}^{\infty} \frac{(-1)^n
     \Gamma(n+\frac{1}{2})}{\sqrt \pi \Gamma(n+1)}\qty[\qty(\frac{ct}{2h})^2 -1
     \tan\xi]^n \\
     \cdot I_n \qty(\frac{4}{\gamma} \sqrt{\frac{c \tau}{n}} \sin 2 \xi),
     \text{ при } t\geq 2h /c
 \end{multline}
 и $P_{FS} = 0 \text{ при } t< 2h/c$


 Это выражение можно упростить, переходя к новому времени $\tau = t - 2h / c$,
 где  $2h / c$ -- время задержки между излучением и приемом сигнала. Учитывая,
 что в масштабах спутниковой альтиметрии  $\frac{c \tau}{h} \ll 1$, получим 

 \begin{multline}
     \label{eq:Pfs:final}
     P_{FS}(\tau) = \frac{G_0^2 \lambda^2 c \sigma^o(\psi_0)}{4(4 \pi)^2 L_p h^3}
     \exp{
         -\frac{4}{\gamma}\sin^2 \xi - \frac{4c}{\gamma h} \tau \cos 2 \xi
     }  \\
     \cdot \sum\limits_{n=0}^{\infty} \frac{(-1)^n \Gamma(n+\frac{1}{2})}{\sqrt
     \pi \Gamma(n+1)} \qty[\sqrt{\frac{c\tau}{h}}\tan \xi]^n
 I_n\qty(\frac{4}{\gamma} \sqrt{\frac{c \tau}{h}} \sin 2 \xi)
     \text{ при } \tau\geq 0
 \end{multline}
 и $P_{FS} = 0, \text{ при } \tau < 0$


 Рассмотрим теперь отдельно сумму из уравнения \eqref{eq:Pfs:final}. Если
 переобозначить $Y=\frac{4}{\gamma} \sqrt{\frac{c\tau}{h}} \sin 2\xi$, то сумма
 примет вид
 \begin{equation}
     \label{eq:sum}
     I_0(Y) \cdot \qty{ 1 + \sum\limits_{n=1}^{\infty} 
     \frac
        {(-1)^n \Gamma(n+\frac{1}{2})}
        {\sqrt \pi \Gamma(n+1)} 
        \cdot \frac{I_n(Y)}{I_0(Y)} \qty[\frac{\gamma Y}{8 \cos^2 \xi}]^n
 }
 \end{equation}
 Поскольку $Y\ll 1$ и $\xi \ll 1$, то множитель  $\qty[\frac{\gamma Y}{8 \cos^2
 \xi}]^n $ будет быстро сходиться к нулю. Следовательно сумму $n$ слагаемых мы
 можем приближенно заменить лишь одним слагаемым при $n=0$.
 \begin{multline}
     \label{eq:Pfs:approx}
     P_{FS}(\tau) = \frac{G_0^2 \lambda^2 c \sigma^o(\psi_0)}{4(4 \pi)^2 L_p h^3}
     \exp{
         -\frac{4}{\gamma}\sin^2 \xi - \frac{4c}{\gamma h} \tau \cos 2 \xi
     }  \\
     \cdot  I_0\qty(\frac{4}{\gamma} \sqrt{\frac{c \tau}{h}} \sin 2 \xi)
     \text{ при } \tau\geq 0
 \end{multline}

 %Пропущу кусок
 %про 
 %Интегрируя почленно, получааем
 %\begin{multline}
     %\label{eq:}
     %P_{FS}(t) = 
     %\frac
        %{2 \sqrt \pi G_0 \lambda^2 \sigma^o(\psi_0)}
        %{(4 \pi)^3 L_p h^4}
     %\cdot\sum\limits_{n=0}^{\infty} 
     %\frac
     %{(-1)^n \Gamma(n+\frac{1}{2})}
     %{\Gamma(n+1)}\\
     %\cdot \int\limits_{0}^{\infty} \qty(\frac{2b}{a})^2 I_n(a) 
     %\cdot \exp{-\frac{4}{\gamma}\qty(1 - \frac{\cos^2 \xi}{1+
     %\epsilon^2})+b} 
     %\cdot \frac
     %{\delta\qty(t - \frac{2h}{c} \sqrt{1+ \epsilon^2})}
     %{(1+\epsilon^2)^2}
     %\rho \dd \rho,
 %\end{multline}
 %где $I_n(a)$ -- функция Бесселя, $\Gamma(n)$ -- гамма-функция Эйлера.



%Из геометрических соображений, можем определить что
%\begin{equation}
    %\label{eq:tanxi}
    %\tan \xi = \sqrt{\frac{c \tau}{h}}
%\end{equation}

Зная отклик плоской морской поверхности на сигнал с радиовысотомера мы
можем перейти к вычислению отклика на взволнованную морскую поверхность.
С точки зрения физики, различия будут в том, что теперь не вся
поверхность может отражать сигнал в нужном направлении, а только
зеркально ориентированные площадки на поверхности. С радиотехнической
точки зрения, взволнованная морская поверхность является линейным
фильтром с импульсной переходной характеристикой $q(t)$.  Тогда отклик
взволнованной поверхности можно вычислить выполняя свертку
\begin{equation}
    \label{eq:PRSconv}
    P_{RS}(t) = q(z) * P_{FS}(t) 
\end{equation}


Результирующая форму импульса будет сверткой функции отклика на плоскую
поверхность $P_{FS}$ и функции распределения зеркальных площадок $q$
 \begin{equation}
    \label{eq:}
    P(\tau) = \frac{c}{\tau} \int\limits_{-\infty}^{\infty} q\qty(\frac{c\tau}{2}
    - \frac{c \tilde \tau}{2}) P_{FS}(\tilde \tau) \dd{\tilde \tau} 
\end{equation}

Функция $P_{FS}$ изменяется гораздо медленне функции плотности зеркальных
точек $q$, а значит можно записать приближенное равенство
\begin{equation}
    \label{eq:Psim}
    P \approx 
    \begin{cases}
        P_{FS}(0) \int\limits_{0}^{\infty} \frac{c}{2}q\qty(\frac{c \tau}{2} -
        \frac{c\tilde \tau}{2}) \dd{\tilde \tau}, &\text{ при } \tau <0\\
        P_{FS}(\tau) \int\limits_{0}^{\infty} \frac{c}{2}q\qty(\frac{c \tau}{2} -
        \frac{c\tilde \tau}{2}) \dd{\tilde \tau}, &\text{ при } \tau <0\\
    \end{cases}
\end{equation}

Согласно теореме о среднем, при большом на-на-на мы можем предположить
распределение Гауссовым
\begin{equation}
    \label{eq:q}
    \frac{c}{2} q\qty(\frac{c\tau}{2}) = 
        \frac
        {1}
        {\sqrt{2 \pi \qty(\frac{2 \sigma_s^2}{c})}}
    \exp{-\frac{\tau^2}{2 \pi \qty(\frac{2 \sigma_s^2}{c})^2}}
\end{equation}

Посчитав свертку, получаем, что
\begin{equation}
    \label{eq:}
    P(\tau) \approx P_{FS}(\tau) \qty[ 1 + \erf\qty(\frac{c\tau}{2 \sqrt 2 \sigma_s})]
\end{equation}

Можно прибегнуть к ещё одному упрощению и разложить в ряд функцию Бесселя в
уравнении \eqref{eq:Pfs:approx}:
\begin{equation}
    I_0(\zeta) = \sum\limits_{n=0}^{\infty} 
    \qty(\frac{\zeta^2}{4})^n \cdot 
    \qty(\frac{1}{n!})^2, \text{ где } \zeta=\frac{4}{\gamma}\sqrt{\frac{c \tau}{h}
    }\sin 2 \xi
\end{equation}
согласно статье \cite{amarouche} можно оставить только два первых члена
разложения, которые, в свою очередь, совпадают с разложением экспоненты
\begin{equation}
    I_0(\zeta) \approx 1 + \frac{\zeta^2}{4} = e^{\frac{\zeta^2}{4}}
\end{equation}
  
Тогда функция $P_{FS}$ примет вид
\begin{equation}
    \label{eq:Pfs}
    P_{FS}(\tau) = A \exp{-\frac{4}{\gamma} \sin^2 \xi} \exp{
        -\frac{4c}{\gamma h}
            \qty(\cos 2\xi - \sin^2 2\xi )\tau}
\end{equation}

Согласно статье \cite{cite:PTR} можно связать дисперсию $\sigma_p$ в \eqref{eq:PTR} c
временным разрешением альтиметра $r_t$:  
\begin{equation}
    \label{eq:sigmap}
    \sigma_p = \frac{1}{2 \sqrt{2 \ln 2}} r_t
\end{equation}

Согласно работе Брауна  \cite{brown}, мы можем выразить $FSSR$ 

Напоследок, следует учесть, что наш приемник (радиолокатор) тоже является
линейной системой с некоторой импульсной характеристикой $P_{T}(t)$. Поэтому необходимо к
уравнению \eqref{eq:PRSconv} добавить ещё одну свертку. Тогда, результирующий
импульс будет равен
\begin{equation}
    \label{eq:Pconv}
    P(t) = P_{FS}(t) * q(t) * P_T(t)
\end{equation}
В свертке \eqref{eq:Pconv}, c учетом \eqref{eq:Pfs},\eqref{eq:Pt} и
\eqref{eq:q}, каждый множитель представляет собой экспоненту. Свертка от трех
экспонент несложно считается. 



Получаем окончательную формулу для сигнала на приемнике радилокатора
\begin{equation}
    \label{eq:brown}
    P(t) = A e^{-v} (1 + \erf(u)), \text{ где}
\end{equation}
$u = \frac{t - \alpha \sigma_c^2}{\sqrt 2 \sigma_c}$, 
$v = \alpha(t - \frac{\alpha}{2} \sigma_c^2)$, 
в которых
$\alpha = \delta - \frac{\beta^2}{4} = 
\frac{4}{\gamma}\cdot \frac{c}{h} \qty(\cos 2\xi - \frac{\sin^2 2\xi}{\gamma})$
$A = A_0 \exp{\frac{- 4}{\gamma} \sin^2 \xi}$ и т.д (формула Брауна без изменений, не
хочется расписывать все обозначения целиком).

График функции \eqref{eq:brown} изображен на рис. \ref{fig:brown}.

\subsection{Восстановление параметров морской поверхности.}%
\label{sub:vosstanovlenie_parametrov_morskoi_poverkhnosti_}

Зная зависимость принятого сигнала от параметров взволнованной морской
поверхности, мы можем восстанавливать их по форме импульса. Это можно сделать,
аппроксимируя практический импульс теоретической формулой и извлекая из
получившегося графика необхожимые коэффициенты.



Браун в своей работе вывел формулу, описывающего форму импульса в предположении
гауссовой плотности вероятности зеркальных площадок на морской поверхности.



Однако решать подобную задачу для формулы \eqref{eq:brown} довольно сложно
из-за сложной зависимости восстанавливаемых параметров и в  их большом
количестве.  Это может приводить к большим вычислительным ошибкам даже при большом соотношении сигнал-шум.

\begin{figure}[h]
    \centering
    \def\svgwidth{0.8\linewidth}
    \import{./fig/}{example_impulse1.pdf_tex}
    \caption{Качественная форма импульса с обозначением основных параметров.}
    \label{fig:impuls}
\end{figure}

Поэтому для решения задачи ретрекинга предлагается, использовать менее физичную, но более наглядную запись формулы
\eqref{eq:brown}:
\begin{equation}
    \label{eq:ice}
    P(t) = A \exp{ S_T (t - \frac{\tau}{2})} \qty(1 + \erf{\frac{t-
    \tau}{\sigma_L}}), \text{ где}
\end{equation}

$S_T$ -- коэффициент наклона заднего фронта импульса, 
 $\tau$ -- эпоха
 $\sigma_L$ -- ширина переднего фронта импульса, 

\paragraph{Поиск наклона заднего фронта}%
\label{par:nakhozhdenie_s_t_}

Формула \eqref{eq:ice}, хороша тем, что можно найти некоторые коэффициенты, не
прибегая к сложным методам оптимизации. После прохождения пика импульса, функция ошибок
становится  медленно меняющейся функцией и можно записать равенство
\begin{equation}
    \label{eq:t>tmax}
    P(t) = 2A \exp{S_T \qty(t - \frac{\tau}{2})}, \text{ при } t > t_{max},
\end{equation}
где $t_{max}$ -- ордината пика импульса.

Логарифмируя \eqref{eq:t>tmax}
\begin{equation}
    \ln P(t) = \ln 2A + S_T( t - \frac{\tau}{2}) = S_T t + \const 
\end{equation}
мы получаем линейную функцию времени. Значит, построив логарифм формы импульса при
$t>t_{max}$ и найдя коэффициент наклона получившейся прямой мы можем найти
наклон заднего фронта $S_T$. Подобная процедура проведена на рис.\ref{fig:S_T}
 %\begin{figure}[h]
    %\centering
    %\includegraphics[width=\linewidth]{../project/radiolocator/imp08_7_1.pdf}
    %\caption{Нахождение наклона заднего фронта}
    %\label{fig:S_T}
%\end{figure}

\paragraph{Поиск ширины переднего фронта}%
Как видно из рис.\ref{fig:erf}, при $t<t_{max}$ функция ошибок
$\erf\qty(\frac{t - \tau}{\sigma_L})$ ведет себя
быстрее экспоненты, а значит можно написать приближенное равенство
\begin{equation}
    \label{eq:erf}
    P(t) \approx A \qty(1 + \erf{\frac{t - \tau}{\sigma_L}})
\end{equation}

%\begin{figure}[h]
    %\centering
    %\includegraphics[width=\linewidth]{../project/radiolocator/imp08_7_2.pdf}
    %\label{fig:erf}
%\end{figure}

Аппроксимируя импульс при $t<t_{max}$ формулой \eqref{eq:erf} мы получим оценку
коэффициентов $A,~\tau,~\sigma_L$. 
%При этом, интересовать нас на этом этапе
%будут в основном  эпоха $\tau$ и ширина переднего фронта  $\sigma_L$.

%\paragraph{Этап 4. Заключительная аппроксимация.}%
\label{par:etap_4_zakliuchitel_naia_approksimatsiia_}

 Имея оценки параметров аппроксимации по различным
участкам функции $P(t)$ мы можем использовать формулу  \eqref{eq:ice} для всего
импульса 
\begin{equation}
    \label{eq:ice}
    P(t) = A \exp{ S_T (t - \frac{\tau}{2})} \qty(1 + \erf{\frac{t-
    \tau}{\sigma_L}}).
\end{equation}
с начальными условиями для параметров $A, S_T, \tau, \sigma_L$, полученных на
предыдущих этапах. 


На рисунках ниже продемострированы результаты работы этого алгоритма на
различных формах импульса (меняются углы отклонения антенны).


\begin{figure}[ht]
    \begin{subfigure}{0.5\linewidth}
        \centering
        \includegraphics[width=\linewidth]{fig/retracking/imp08_7_3}
        \caption{Обработка файла imp08\_7.dat}
        \label{fig:}
    \end{subfigure}
    \begin{subfigure}{0.5\linewidth}
        \centering
        \includegraphics[width=\linewidth]{fig/retracking/imp_5_3}
        \caption{Обработка файла imp\_5.dat}
        \label{fig:}
    \end{subfigure}
    \begin{subfigure}{0.5\linewidth}
        \centering
        \includegraphics[width=\linewidth]{fig/retracking/imp04_10_3}
        \caption{Обработка файла imp04\_10.dat}
        \label{fig:}
    \end{subfigure}
    \begin{subfigure}{0.5\linewidth}
        \centering
        \includegraphics[width=\linewidth]{fig/retracking/imp_15a_3}
        \caption{Обработка файла imp15a.dat}
        \label{fig:}
    \end{subfigure}
\end{figure}






%\begin{figure}[H]
    %\centering
    %\includegraphics[width=\linewidth]{fig/retracking/imp_15a_3}
    %\caption{Обработка файла imp15a.dat}
    %\label{fig:ex}
%\end{figure}




%\paragraph{Восстановление параметров}%
%\label{par:etap_5_vosstanovlenie_parametrov_}

%Не сложно найти связь коэффициентов в формуле Брауна \eqref{eq:brown} и формуле
%ICE  \eqref{eq:ice}:

%\begin{gather}
    %\label{eq:}
    %S_T = - \alpha\\
    %%\tau = \alpha \cdot \sigma_c^2 \\
    %\sigma_l = \sqrt 2 \sigma_c
%\end{gather}

%Найдя коэффициенты для формулы \eqref{eq:ice} перейдем к формуле
%\eqref{eq:brown}
%и будем решать систему коэффициентов относительно неизвестных параметров
%радиовысотомера и состояния морской поверхности.

%\begin{gather}
    %A(A_0,\xi) = A_0 \exp{-\frac{4}{\gamma} \sin^2 \xi} \\
    %\alpha(\xi,h) = \frac{4c}{\gamma h} \cdot (\cos 2\xi - 
            %\frac{\sin^2 2\xi}{\gamma}) \\
    %\sigma_c^2 = \sigma_p^2 + \frac{\sigma_s^2}{c^2}
%\end{gather}


